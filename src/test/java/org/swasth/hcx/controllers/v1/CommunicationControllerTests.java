package org.swasth.hcx.controllers.v1;

import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.http.MediaType;
import org.springframework.mock.web.MockHttpServletResponse;
import org.springframework.test.web.servlet.MvcResult;
import org.swasth.hcx.controllers.BaseSpec;


import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.ArgumentMatchers.any;
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;

public class CommunicationControllerTests extends BaseSpec {

    @Value("${hcx_application.api_version}")
    private String api_version;

    @Test
    public void check_communication_request_success_scenario() throws Exception {
        postgresService.execute("DROP TABLE IF EXISTS mock_participant");
        postgresService.execute("CREATE TABLE mock_participant (\n" +
                "    parent_participant_code character varying,\n" +
                "    child_participant_code character varying PRIMARY KEY,\n" +
                "    primary_email character varying,\n" +
                "    password character varying,\n" +
                "    private_key character varying\n" +
                ");");
        postgresService.execute("INSERT INTO mock_participant(parent_participant_code,child_participant_code,primary_email,password,private_key)"+"VALUES ('hosp_hcx_955522@swasth-hcx-dev ','bsp_bsprol_846730@swasth-hcx-dev','lagertha+mock_payor@yopmail.com','Opensaber@123','-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCK6oTARsBHWD1M 8KTeMDrzkMPklmLilUqxqUXgjKfACdAsZLZtMlxLgWviFRxRglAgC33gS5On6DIE poiK6DQn2gushScJl6bRlA4vGCmYA+cO2d8O0rpkkJxWGq0K5LGb7umBkSNO0hyG DgngHviH8pYkqn9D1X7FuG2t912X4qg/db5Fp3NuS8ZRWJ9tk7fgWzLveNizsPS3 m8bqxikJ/RJL9g0EHURtzJWc2liBYGTtqhO5oeM2kovmaOn7a//AhnTcOZn2/eOe WiOmPRxSjjFyugREK+bAGTSfVq83003CJQ+kHg+cfOqBbCT+0J0LwLQAeLiKrLPS 07HVns3TAgMBAAECggEAFfns32gx90zH1y9YvbJpQ7/6pY5+/Ukl7xOQM5USMrNl ZKiCzaVCbErWBjGrGwqft2S/WKehfSt4F5FAQk1izDfWp0fMpFwCmYmFHEEuegHg C1Lp/UksEJ2/WxskQKLA+vdhpyGOsY5UJzGlsU2PqXN1+j34x9fzaBR5ps8JK5kF rbwr8En+hsfShSn3nklMiEyBI7bPDbpaq2Qjpfay/XRzqRdkPhsd+n03ADKGd4ax lyAe/VFak6JdpTy+oxWjc2dr2mOWIX9sOCSVOL7sTVX3Wcxhg0FlNbwmbx6nF+UW OJxVO9UNod/OtzSzYsqObJ/z76itUMcBnDl7almtjQKBgQC3Doo8UlvECcQvkrny Nk49oOLaheZA8R2Cw+3oK3ufMvahLEemxCFlZjbkmoeeRySzyPCs7jEr8HK1GQGu tv8yS4mkx7lCR2B3jl0NJ7r7kcitZh4VFaMXJORwpMoawMeWvc/u7Xh+OZRMp7c2 bfc9114dynCDtwp+dLjG8+y+5wKBgQDCRTlxXu7Kg5AL7H07n5q1r9IfOqfL4inB LXNEciddvaOtFzomjr/6sbGdK+ICeFyk9E12esWnbziaI/E8oSogL4dX+t5hbc5T tvrPs/mILztR1xvUdTNLyT9SOr7dEehytvOLsuHlFcCli7H6nZdrRCVFgeYXWZhM KR5Uagl4NQKBgQCOTHY2+AqvtKvWE2gKmh5uF9/g4Q+hUg2PtkD9JrgdhB9mIKa+ Q152lWN8h4d/CWzFeSFmPG7q6ioxDvRY3ZY5gbDI8BzaIeQia/93l3fp0WS/Lk+a MkyqVBpkWiVlcJB2ZKz73Yu6C4Z1pDZu0ELOxtk5rUGTkjlNHez5c2qI5wKBgQC1 NbMWQBIHjt6vcKGEGyVJcj5SaPkZodWG3ulVIBH+S6VAEJlqW99RbayaSdOgsDri lwsmh/CUdJdcmEguYLqVmR/q/hOu16kMx3J+iYcp87ymYzsPW19EwuywvCFKvqiP UH4ugeZaNIclJAAZICScps0JX9iLUURRTk1/OgWpPQKBgAD6pmbZCYk0B8TClPvs FSV12HUdMo9f7jteQP4TkmJhi+IOrMmBWVrwH6JgPf/awJPhmGM+g375JswSeugd u7ovcvivsL5JKNMeM35SfrF3xZ3VxX7jcOt/gM1nK9vXgGMJivf5TQIaF0piuwzG b5tlHhnq33FF0Y8MYB2Y4d4B\n-----END PRIVATE KEY-----')");
        postgresService.execute("DROP TABLE IF EXISTS payersystem_data");
        postgresService.execute("CREATE TABLE payersystem_data (\n" +
                "    request_id character varying not null PRIMARY KEY,\n" +
                "    sender_code character varying,\n" +
                "    recipient_code character varying,\n" +
                "    action character varying,\n" +
                "    raw_payload character varying,\n" +
                "    request_fhir character varying,\n" +
                "    response_fhir character varying,\n" +
                "    status character varying,\n" +
                "    additional_info jsonb,\n" +
                "    created_on bigint,\n" +
                "    updated_on bigint,\n" +
                "    on_action_status character varying,\n" +
                "    correlation_id character varying,\n" +
                "    mobile character varying,\n" +
                "    otp_verification character varying,\n" +
                "    workflow_id character varying,\n" +
                "    account_number character varying,\n" +
                "    ifsc_code character varying,\n" +
                "    bank_details character varying,\n" +
                "    app character varying,\n" +
                "    supporting_documents jsonb,\n" +
                "    bill_amount character varying,\n" +
                "    insurance_id character varying,\n" +
                "    patient_name character varying,\n" +
                "    service_type character varying\n" +
                ");\n");
        postgresService.execute("INSERT INTO payersystem_data" +
                "(request_id, sender_code, recipient_code, action, raw_payload, request_fhir, response_fhir, status, additional_info, created_on, updated_on, on_action_status, correlation_id, mobile, otp_verification, workflow_id, account_number, ifsc_code, bank_details, app, supporting_documents, bill_amount, insurance_id, patient_name, service_type)" +
                "VALUES" + "('7b128be8-6a31-4305-a1cc-8d1e6a6fcc04', 'bsp_bsprol_846730@swasth-hcx-dev', 'payr_hcxmoc_903588@swasth-hcx-dev', 'claim', 'eyJ4LWhjeC1yZWNpcGllbnRfY29kZSI6ImJzcF9ic3Byb2xfODQ2NzMwQHN3YXN0aC1oY3gtZGV2IiwieC1oY3gtdGltZXN0YW1wIjoiMjAyNC0wMS0yNFQwNzoxOTo1NCswMDAwIiwieC1oY3gtc2VuZGVyX2NvZGUiOiJwYXlyX2hjeG1vY185MDM1ODhAc3dhc3RoLWhjeC1kZXYiLCJ4LWhjeC1jb3JyZWxhdGlvbl9pZCI6ImRkYzQ5YjE0LWViYzAtNDY4Ni1hMjk3LTIzOWJlZDgyMzg5ZiIsImVuYyI6IkEyNTZHQ00iLCJ4LWhjeC13b3JrZmxvd19pZCI6IjdhNTQ5NzAyLWRkYjItNGU3Mi1hYzIxLTQzOGQxZmUzYzQzOSIsImFsZyI6IlJTQS1PQUVQLTI1NiIsIngtaGN4LWFwaV9jYWxsX2lkIjoiMDQ1YTYwZDEtZDczYS00ZGE5LTkzZmQtNzk3NzRjNzRmNDZiIn0.gVvap-Bq5lKqsq28LEikeoSX6l4QZuKXGLke_xH5gW7RCViNFqkuoqlF951Yv-9xslx901QsAvZHOZ9h7fJoUmYe03-7_CGP_IN79dygujmnkbyNGb7Pt2ytpPbXyJbeUmU5VKugbs-Ux1UZ5xCb0f8A4blB2gFG8cGSjx_cGfYEndGVNRMiPH4loLnPn7QQ5GULJk2zRY9ITdOJv_s_RKOfdqINtoJq0SPB9A2jEPqBYvAcc4UeNkaFKV-vTDs4Dsi3ynrQIwIoqGZUPsEL_RU7jKTf5NTA5tk01bSSrBBIkMBFq3QcpiypEZPl8azJAodtyeb1gJrydxTHnim3oQ.x7ZRbCg-ByChU5lq.dgfEIAmcD_W3nbCshly5txshHyL9ckpH--YQI-ovJ-8yTWDDAWvLRmfkSi5jMHktWPk7RIMUFslVwYMy2PsBreNEJeo49ACbrsxXP8I8yarMlDGx1c9tYGruEiqh9-QwKMLgLXr8z0fuTopQlkXKoCvmdE4N7ALxL_ixzw8lCSUBzbUER9biYAfuKcr4ZNNfc0KJMiTOXBu0VDwz2ndK0XO7SSAGu4VLFm_l1dsvKiCauPkER4h72wPrgJ8qf8z8v6WSH9ryajIQ_TQq1cmLsi7RLx7wpqpmdO8OFm_0PkIIcEk1tBPVuXBntl6fKNttAyeRwp4NeJo85s14YjmysyuuI0O24-OR-cpYacUrDVY5dE14JMTU1-lq_9hUPHtxRvXfhR5WdBnsCeyQg2DL78gw4sD8TsQhe-UNhTrxIgXg6GCcUxJiYRW_MTuNwJ4LXt7FQwhUF7ZAmyNlZ_hmzTiyjVqJ8vfR-MZGVQMRLIeZQAcnpiXfd-zkx0omCW3EfHV8a2H6D6Ig56YVK-CLW81T9fJWS9_M45R7TFythsUeRoai4hRVbWp4WUinOLdBKPJddoDCL5x_YbRTXj7pl39ltQeSt64myLNyq-ZQ3XJrH3YV_nSAbNW_wB8.mss8qUyRt_PBpQQHFji4Rg', '{}', '{\"identifier\":{\"system\":\"https://www.tmh.in/bundle\",\"value\":\"f3f964cc-ca80-4b6a-a465-4bd644d42b0f\"},\"entry\":[{\"resource\":{\"insurance\":[{\"coverage\":{\"reference\" :\"Coverage/COVERAGE1\"}}],\"identifier\":[{\"value\":\"req_70e02576-f5f5-424f-b115-b5f1029704d4\"}],\"item\":[{\"diagnosis\":[{\"diagnosisCodeableConcept\":{\"coding\":[{\"system\":\"https://irdai.gov.in/package-code\",\"cod e\":\"E906184\",\"display\":\"SINGLE INCISION LAPAROSCOPIC APPENDECTOMY\"}],\"text\":\"SINGLE INCISION LAPAROSCOPIC APPENDECTOMY\"}}],\"productOrService\":{\"coding\":[{\"system\":\"https://irdai.gov.in/package-code\",\"code \":\"E101021\",\"display\":\"Twin Sharing Ac\"}],\"text\":\" twin sharing basis room package\"}}],\"purpose\":[\"benefits\"],\"created\":\"2024-01-19T10:55:12+00:00\",\"priority\":{\"coding\":[{\"system\":\"http://terminology.hl7. org/CodeSystem/processpriority\",\"code\":\"normal\"}]},\"provider\":{\"reference\":\"Organization/GICOFINDIA\"},\"meta\":{\"profile\":[\"https://ig.hcxprotocol.io/v0.7.1/StructureDefinition-CoverageEligibilityRequest.ht ml\"]},\"patient\":{\"reference\":\"Patient/RVH1003\"},\"insurer\":{\"reference\":\"Organization/WeMeanWell01\"},\"enterer\":{\"reference\":\"Practitioner/PractitionerViswasKar\"},\"id\":\"dc82673b-8c71-48c2-8a17-16dcb3b035f6\" ,\"text\":{\"div\":\"<div xmlns=\\\"http://www.w3.org/1999/xhtml\\\">ABSP</div>\",\"status\":\"generated\"},\"servicedDate\":\"0026-12-13\",\"facility\":{\"reference\":\"http://sgh.com.sa/Location/4461281\"},\"resourceType\":\"Cove rageEligibilityRequest\",\"status\":\"active\"},\"fullUrl\":\"CoverageEligibilityRequest/dc82673b-8c71-48c2-8a17-16dcb3b035f6\"},{\"resource\":{\"identifier\":[{\"system\":\"http://abdm.gov.in/facilities\",\"type\":{\"coding \":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"AC\",\"display\":\"Narayana\"}]},\"value\":\"HFR-ID-FOR-TMH\"}],\"address\":[{\"country\":\"India\",\"city\":\"Bengaluru\",\"text\":\" Bannerghatta Road, Ben galuru \"}],\"meta\":{\"profile\":[\"https://nrces.in/ndhm/fhir/r4/StructureDefinition/Organization\"]},\"name\":\"BSP Role Mock User\",\"id\":\"WeMeanWell01\",\"resourceType\":\"Organization\"},\"fullUrl\":\"Organization/WeMe anWell01\"},{\"resource\":{\"identifier\":[{\"system\":\"http://irdai.gov.in/insurers\",\"type\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"AC\",\"display\":\"GOVOFINDIA\"}]},\"value\":\"GI COFINDIA\"}],\"meta\":{\"profile\":[\"https://nrces.in/ndhm/fhir/r4/StructureDefinition/Organization\"]},\"name\":\"Demo Payor\",\"id\":\"GICOFINDIA\",\"resourceType\":\"Organization\"},\"fullUrl\":\"Organization/GICOFINDIA\"}, {\"resource\":{\"identifier\":[{\"system\":\"http://gicofIndia.com/beneficiaries\",\"type\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"SN\",\"display\":\"Subscriber Number\"}]},\"value\": \"BEN-101\"}],\"address\":[{\"country\":\"India\",\"city\":\"Bengaluru\",\"postalCode\":\"560056\",\"text\":\"#39 Kalena Agrahara, Kamanahalli, Bengaluru - 560056\",\"state\":\"Karnataka\"}],\"gender\":\"male\",\"meta\":{\"profile\":[\"h ttps://nrces.in/ndhm/fhir/r4/StructureDefinition/Patient\"]},\"name\":[{\"text\":\"Abhishek\"}],\"telecom\":[{\"system\":\"phone\",\"value\":\"9620499129\"}],\"id\":\"RVH1003\",\"birthDate\":\"1960-09-26\",\"resourceType\":\"Patient \"},\"fullUrl\":\"Patient/RVH1003\"},{\"resource\":{\"identifier\":[{\"system\":\"https://www.gicofIndia.in/policies\",\"value\":\"policy-RVH1003\"}],\"subscriber\":{\"reference\":\"Patient/RVH1003\"},\"payor\":[{\"reference\":\"Org anization/GICOFINDIA\"}],\"beneficiary\":{\"reference\":\"Patient/RVH1003\"},\"meta\":{\"profile\":[\"https://ig.hcxprotocol.io/v0.7.1/StructureDefinition-Coverage.html\"]},\"subscriberId\":\"ABCD1234\",\"id\":\"COVERAGE1\",\" relationship\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/subscriber-relationship\",\"code\":\"self\"}]},\"resourceType\":\"Coverage\",\"status\":\"active\"},\"fullUrl\":\"Coverage/COVERAGE1\"},{\"resource\" :{\"identifier\":[{\"system\":\"http://abdm.gov.in/facilities\",\"type\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"MD\",\"display\":\"Medical License number\"}]},\"value\":\"DOC-123/456 \"}],\"meta\":{\"profile\":[\"https://nrces.in/ndhm/fhir/r4/StructureDefinition/Practitioner\"]},\"name\":[{\"text\":\"Dr Viswas kar\"}],\"id\":\"PractitionerViswasKar\",\"resourceType\":\"Practitioner\"},\"fullUrl\":\"Practitio ner/PractitionerViswasKar\"}],\"meta\":{\"lastUpdated\":\"2024-01-19T10:55:13.300+00:00\",\"profile\":[\"https://ig.hcxprotocol.io/v0.7.1/StructureDefinition-CoverageEligibilityRequestBundle.html\"]},\"id\":\"4b35c99b- 4081-46c6-b927-98720d8ac8a6\",\"type\":\"collection\",\"resourceType\":\"Bundle\",\"timestamp\":\"2024-01-19T10:55:13.300+00:00\"}', 'Approved', '{}', '1705661714568', '1705661715600', '', 'ddc49b14-ebc0-4686-a297-239bed82389f', '9620499129', 'Pending', '7a549702-ddb2-4e72-ac21-438d1fe3c439', '1234', '1234', 'Pending', 'ABSP', '{}', '32329', 'ABCD1234.', 'Abhishek.', 'medical')");
        String requestBody = getCommunicationRequestBody();
        MvcResult mvcResult = mockMvc.perform(post("/"+api_version+"/communication/request").content(requestBody).contentType(MediaType.APPLICATION_JSON)).andReturn();
        MockHttpServletResponse response = mvcResult.getResponse();
        int status = response.getStatus();
        assertEquals(202, status);
    }

    @Test
    public void check_communication_request_otp_success_scenario() throws Exception {
        postgresService.execute("DROP TABLE IF EXISTS mock_participant");
        postgresService.execute("CREATE TABLE mock_participant (\n" +
                "    parent_participant_code character varying,\n" +
                "    child_participant_code character varying PRIMARY KEY,\n" +
                "    primary_email character varying,\n" +
                "    password character varying,\n" +
                "    private_key character varying\n" +
                ");");
        postgresService.execute("INSERT INTO mock_participant(parent_participant_code,child_participant_code,primary_email,password,private_key)"+"VALUES ('hosp_hcx_955522@swasth-hcx-dev ','bsp_bsprol_846730@swasth-hcx-dev','lagertha+mock_payor@yopmail.com','Opensaber@123','-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCK6oTARsBHWD1M 8KTeMDrzkMPklmLilUqxqUXgjKfACdAsZLZtMlxLgWviFRxRglAgC33gS5On6DIE poiK6DQn2gushScJl6bRlA4vGCmYA+cO2d8O0rpkkJxWGq0K5LGb7umBkSNO0hyG DgngHviH8pYkqn9D1X7FuG2t912X4qg/db5Fp3NuS8ZRWJ9tk7fgWzLveNizsPS3 m8bqxikJ/RJL9g0EHURtzJWc2liBYGTtqhO5oeM2kovmaOn7a//AhnTcOZn2/eOe WiOmPRxSjjFyugREK+bAGTSfVq83003CJQ+kHg+cfOqBbCT+0J0LwLQAeLiKrLPS 07HVns3TAgMBAAECggEAFfns32gx90zH1y9YvbJpQ7/6pY5+/Ukl7xOQM5USMrNl ZKiCzaVCbErWBjGrGwqft2S/WKehfSt4F5FAQk1izDfWp0fMpFwCmYmFHEEuegHg C1Lp/UksEJ2/WxskQKLA+vdhpyGOsY5UJzGlsU2PqXN1+j34x9fzaBR5ps8JK5kF rbwr8En+hsfShSn3nklMiEyBI7bPDbpaq2Qjpfay/XRzqRdkPhsd+n03ADKGd4ax lyAe/VFak6JdpTy+oxWjc2dr2mOWIX9sOCSVOL7sTVX3Wcxhg0FlNbwmbx6nF+UW OJxVO9UNod/OtzSzYsqObJ/z76itUMcBnDl7almtjQKBgQC3Doo8UlvECcQvkrny Nk49oOLaheZA8R2Cw+3oK3ufMvahLEemxCFlZjbkmoeeRySzyPCs7jEr8HK1GQGu tv8yS4mkx7lCR2B3jl0NJ7r7kcitZh4VFaMXJORwpMoawMeWvc/u7Xh+OZRMp7c2 bfc9114dynCDtwp+dLjG8+y+5wKBgQDCRTlxXu7Kg5AL7H07n5q1r9IfOqfL4inB LXNEciddvaOtFzomjr/6sbGdK+ICeFyk9E12esWnbziaI/E8oSogL4dX+t5hbc5T tvrPs/mILztR1xvUdTNLyT9SOr7dEehytvOLsuHlFcCli7H6nZdrRCVFgeYXWZhM KR5Uagl4NQKBgQCOTHY2+AqvtKvWE2gKmh5uF9/g4Q+hUg2PtkD9JrgdhB9mIKa+ Q152lWN8h4d/CWzFeSFmPG7q6ioxDvRY3ZY5gbDI8BzaIeQia/93l3fp0WS/Lk+a MkyqVBpkWiVlcJB2ZKz73Yu6C4Z1pDZu0ELOxtk5rUGTkjlNHez5c2qI5wKBgQC1 NbMWQBIHjt6vcKGEGyVJcj5SaPkZodWG3ulVIBH+S6VAEJlqW99RbayaSdOgsDri lwsmh/CUdJdcmEguYLqVmR/q/hOu16kMx3J+iYcp87ymYzsPW19EwuywvCFKvqiP UH4ugeZaNIclJAAZICScps0JX9iLUURRTk1/OgWpPQKBgAD6pmbZCYk0B8TClPvs FSV12HUdMo9f7jteQP4TkmJhi+IOrMmBWVrwH6JgPf/awJPhmGM+g375JswSeugd u7ovcvivsL5JKNMeM35SfrF3xZ3VxX7jcOt/gM1nK9vXgGMJivf5TQIaF0piuwzG b5tlHhnq33FF0Y8MYB2Y4d4B\n-----END PRIVATE KEY-----')");
        postgresService.execute("DROP TABLE IF EXISTS payersystem_data");
        postgresService.execute("CREATE TABLE payersystem_data (\n" +
                "    request_id character varying not null PRIMARY KEY,\n" +
                "    sender_code character varying,\n" +
                "    recipient_code character varying,\n" +
                "    action character varying,\n" +
                "    raw_payload character varying,\n" +
                "    request_fhir character varying,\n" +
                "    response_fhir character varying,\n" +
                "    status character varying,\n" +
                "    additional_info jsonb,\n" +
                "    created_on bigint,\n" +
                "    updated_on bigint,\n" +
                "    on_action_status character varying,\n" +
                "    correlation_id character varying,\n" +
                "    mobile character varying,\n" +
                "    otp_verification character varying,\n" +
                "    workflow_id character varying,\n" +
                "    account_number character varying,\n" +
                "    ifsc_code character varying,\n" +
                "    bank_details character varying,\n" +
                "    app character varying,\n" +
                "    supporting_documents jsonb,\n" +
                "    bill_amount character varying,\n" +
                "    insurance_id character varying,\n" +
                "    patient_name character varying,\n" +
                "    service_type character varying\n" +
                ");\n");
        postgresService.execute("INSERT INTO payersystem_data" +
                "(request_id, sender_code, recipient_code, action, raw_payload, request_fhir, response_fhir, status, additional_info, created_on, updated_on, on_action_status, correlation_id, mobile, otp_verification, workflow_id, account_number, ifsc_code, bank_details, app, supporting_documents, bill_amount, insurance_id, patient_name, service_type)" +
                "VALUES" + "('7b128be8-6a31-4305-a1cc-8d1e6a6fcc04', 'bsp_bsprol_846730@swasth-hcx-dev', 'payr_hcxmoc_903588@swasth-hcx-dev', 'claim', 'eyJ4LWhjeC1yZWNpcGllbnRfY29kZSI6ImJzcF9ic3Byb2xfODQ2NzMwQHN3YXN0aC1oY3gtZGV2IiwieC1oY3gtdGltZXN0YW1wIjoiMjAyNC0wMS0yNFQwNzoxOTo1NCswMDAwIiwieC1oY3gtc2VuZGVyX2NvZGUiOiJwYXlyX2hjeG1vY185MDM1ODhAc3dhc3RoLWhjeC1kZXYiLCJ4LWhjeC1jb3JyZWxhdGlvbl9pZCI6ImRkYzQ5YjE0LWViYzAtNDY4Ni1hMjk3LTIzOWJlZDgyMzg5ZiIsImVuYyI6IkEyNTZHQ00iLCJ4LWhjeC13b3JrZmxvd19pZCI6IjdhNTQ5NzAyLWRkYjItNGU3Mi1hYzIxLTQzOGQxZmUzYzQzOSIsImFsZyI6IlJTQS1PQUVQLTI1NiIsIngtaGN4LWFwaV9jYWxsX2lkIjoiMDQ1YTYwZDEtZDczYS00ZGE5LTkzZmQtNzk3NzRjNzRmNDZiIn0.gVvap-Bq5lKqsq28LEikeoSX6l4QZuKXGLke_xH5gW7RCViNFqkuoqlF951Yv-9xslx901QsAvZHOZ9h7fJoUmYe03-7_CGP_IN79dygujmnkbyNGb7Pt2ytpPbXyJbeUmU5VKugbs-Ux1UZ5xCb0f8A4blB2gFG8cGSjx_cGfYEndGVNRMiPH4loLnPn7QQ5GULJk2zRY9ITdOJv_s_RKOfdqINtoJq0SPB9A2jEPqBYvAcc4UeNkaFKV-vTDs4Dsi3ynrQIwIoqGZUPsEL_RU7jKTf5NTA5tk01bSSrBBIkMBFq3QcpiypEZPl8azJAodtyeb1gJrydxTHnim3oQ.x7ZRbCg-ByChU5lq.dgfEIAmcD_W3nbCshly5txshHyL9ckpH--YQI-ovJ-8yTWDDAWvLRmfkSi5jMHktWPk7RIMUFslVwYMy2PsBreNEJeo49ACbrsxXP8I8yarMlDGx1c9tYGruEiqh9-QwKMLgLXr8z0fuTopQlkXKoCvmdE4N7ALxL_ixzw8lCSUBzbUER9biYAfuKcr4ZNNfc0KJMiTOXBu0VDwz2ndK0XO7SSAGu4VLFm_l1dsvKiCauPkER4h72wPrgJ8qf8z8v6WSH9ryajIQ_TQq1cmLsi7RLx7wpqpmdO8OFm_0PkIIcEk1tBPVuXBntl6fKNttAyeRwp4NeJo85s14YjmysyuuI0O24-OR-cpYacUrDVY5dE14JMTU1-lq_9hUPHtxRvXfhR5WdBnsCeyQg2DL78gw4sD8TsQhe-UNhTrxIgXg6GCcUxJiYRW_MTuNwJ4LXt7FQwhUF7ZAmyNlZ_hmzTiyjVqJ8vfR-MZGVQMRLIeZQAcnpiXfd-zkx0omCW3EfHV8a2H6D6Ig56YVK-CLW81T9fJWS9_M45R7TFythsUeRoai4hRVbWp4WUinOLdBKPJddoDCL5x_YbRTXj7pl39ltQeSt64myLNyq-ZQ3XJrH3YV_nSAbNW_wB8.mss8qUyRt_PBpQQHFji4Rg', '{}', '{\"identifier\":{\"system\":\"https://www.tmh.in/bundle\",\"value\":\"f3f964cc-ca80-4b6a-a465-4bd644d42b0f\"},\"entry\":[{\"resource\":{\"insurance\":[{\"coverage\":{\"reference\" :\"Coverage/COVERAGE1\"}}],\"identifier\":[{\"value\":\"req_70e02576-f5f5-424f-b115-b5f1029704d4\"}],\"item\":[{\"diagnosis\":[{\"diagnosisCodeableConcept\":{\"coding\":[{\"system\":\"https://irdai.gov.in/package-code\",\"cod e\":\"E906184\",\"display\":\"SINGLE INCISION LAPAROSCOPIC APPENDECTOMY\"}],\"text\":\"SINGLE INCISION LAPAROSCOPIC APPENDECTOMY\"}}],\"productOrService\":{\"coding\":[{\"system\":\"https://irdai.gov.in/package-code\",\"code \":\"E101021\",\"display\":\"Twin Sharing Ac\"}],\"text\":\" twin sharing basis room package\"}}],\"purpose\":[\"benefits\"],\"created\":\"2024-01-19T10:55:12+00:00\",\"priority\":{\"coding\":[{\"system\":\"http://terminology.hl7. org/CodeSystem/processpriority\",\"code\":\"normal\"}]},\"provider\":{\"reference\":\"Organization/GICOFINDIA\"},\"meta\":{\"profile\":[\"https://ig.hcxprotocol.io/v0.7.1/StructureDefinition-CoverageEligibilityRequest.ht ml\"]},\"patient\":{\"reference\":\"Patient/RVH1003\"},\"insurer\":{\"reference\":\"Organization/WeMeanWell01\"},\"enterer\":{\"reference\":\"Practitioner/PractitionerViswasKar\"},\"id\":\"dc82673b-8c71-48c2-8a17-16dcb3b035f6\" ,\"text\":{\"div\":\"<div xmlns=\\\"http://www.w3.org/1999/xhtml\\\">ABSP</div>\",\"status\":\"generated\"},\"servicedDate\":\"0026-12-13\",\"facility\":{\"reference\":\"http://sgh.com.sa/Location/4461281\"},\"resourceType\":\"Cove rageEligibilityRequest\",\"status\":\"active\"},\"fullUrl\":\"CoverageEligibilityRequest/dc82673b-8c71-48c2-8a17-16dcb3b035f6\"},{\"resource\":{\"identifier\":[{\"system\":\"http://abdm.gov.in/facilities\",\"type\":{\"coding \":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"AC\",\"display\":\"Narayana\"}]},\"value\":\"HFR-ID-FOR-TMH\"}],\"address\":[{\"country\":\"India\",\"city\":\"Bengaluru\",\"text\":\" Bannerghatta Road, Ben galuru \"}],\"meta\":{\"profile\":[\"https://nrces.in/ndhm/fhir/r4/StructureDefinition/Organization\"]},\"name\":\"BSP Role Mock User\",\"id\":\"WeMeanWell01\",\"resourceType\":\"Organization\"},\"fullUrl\":\"Organization/WeMe anWell01\"},{\"resource\":{\"identifier\":[{\"system\":\"http://irdai.gov.in/insurers\",\"type\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"AC\",\"display\":\"GOVOFINDIA\"}]},\"value\":\"GI COFINDIA\"}],\"meta\":{\"profile\":[\"https://nrces.in/ndhm/fhir/r4/StructureDefinition/Organization\"]},\"name\":\"Demo Payor\",\"id\":\"GICOFINDIA\",\"resourceType\":\"Organization\"},\"fullUrl\":\"Organization/GICOFINDIA\"}, {\"resource\":{\"identifier\":[{\"system\":\"http://gicofIndia.com/beneficiaries\",\"type\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"SN\",\"display\":\"Subscriber Number\"}]},\"value\": \"BEN-101\"}],\"address\":[{\"country\":\"India\",\"city\":\"Bengaluru\",\"postalCode\":\"560056\",\"text\":\"#39 Kalena Agrahara, Kamanahalli, Bengaluru - 560056\",\"state\":\"Karnataka\"}],\"gender\":\"male\",\"meta\":{\"profile\":[\"h ttps://nrces.in/ndhm/fhir/r4/StructureDefinition/Patient\"]},\"name\":[{\"text\":\"Abhishek\"}],\"telecom\":[{\"system\":\"phone\",\"value\":\"9620499129\"}],\"id\":\"RVH1003\",\"birthDate\":\"1960-09-26\",\"resourceType\":\"Patient \"},\"fullUrl\":\"Patient/RVH1003\"},{\"resource\":{\"identifier\":[{\"system\":\"https://www.gicofIndia.in/policies\",\"value\":\"policy-RVH1003\"}],\"subscriber\":{\"reference\":\"Patient/RVH1003\"},\"payor\":[{\"reference\":\"Org anization/GICOFINDIA\"}],\"beneficiary\":{\"reference\":\"Patient/RVH1003\"},\"meta\":{\"profile\":[\"https://ig.hcxprotocol.io/v0.7.1/StructureDefinition-Coverage.html\"]},\"subscriberId\":\"ABCD1234\",\"id\":\"COVERAGE1\",\" relationship\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/subscriber-relationship\",\"code\":\"self\"}]},\"resourceType\":\"Coverage\",\"status\":\"active\"},\"fullUrl\":\"Coverage/COVERAGE1\"},{\"resource\" :{\"identifier\":[{\"system\":\"http://abdm.gov.in/facilities\",\"type\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"MD\",\"display\":\"Medical License number\"}]},\"value\":\"DOC-123/456 \"}],\"meta\":{\"profile\":[\"https://nrces.in/ndhm/fhir/r4/StructureDefinition/Practitioner\"]},\"name\":[{\"text\":\"Dr Viswas kar\"}],\"id\":\"PractitionerViswasKar\",\"resourceType\":\"Practitioner\"},\"fullUrl\":\"Practitio ner/PractitionerViswasKar\"}],\"meta\":{\"lastUpdated\":\"2024-01-19T10:55:13.300+00:00\",\"profile\":[\"https://ig.hcxprotocol.io/v0.7.1/StructureDefinition-CoverageEligibilityRequestBundle.html\"]},\"id\":\"4b35c99b- 4081-46c6-b927-98720d8ac8a6\",\"type\":\"collection\",\"resourceType\":\"Bundle\",\"timestamp\":\"2024-01-19T10:55:13.300+00:00\"}', 'Approved', '{}', '1705661714568', '1705661715600', '', 'ddc49b14-ebc0-4686-a297-239bed82389f', '9620499129', 'successful', '7a549702-ddb2-4e72-ac21-438d1fe3c439', '1234', '1234', 'Pending', 'ABSP', '{}', '32329', 'ABCD1234.', 'Abhishek.', 'medical')");
        String requestBody = getCommunicationRequestBody();
        MvcResult mvcResult = mockMvc.perform(post("/"+api_version+"/communication/request").content(requestBody).contentType(MediaType.APPLICATION_JSON)).andReturn();
        MockHttpServletResponse response = mvcResult.getResponse();
        int status = response.getStatus();
        assertEquals(202, status);
    }

    @Test
    public void check_communication_on_request_success_scenario() throws Exception {
        postgresService.execute("DROP TABLE IF EXISTS mock_participant");
        postgresService.execute("CREATE TABLE mock_participant (\n" +
                "    parent_participant_code character varying,\n" +
                "    child_participant_code character varying PRIMARY KEY,\n" +
                "    primary_email character varying,\n" +
                "    password character varying,\n" +
                "    private_key character varying\n" +
                ");");
        postgresService.execute("INSERT INTO mock_participant(parent_participant_code,child_participant_code,primary_email,password,private_key)"+"VALUES ('hosp_hcx_955522@swasth-hcx-dev ','bsp_bsprol_846730@swasth-hcx-dev','lagertha+mock_payor@yopmail.com','Opensaber@123','-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCK6oTARsBHWD1M 8KTeMDrzkMPklmLilUqxqUXgjKfACdAsZLZtMlxLgWviFRxRglAgC33gS5On6DIE poiK6DQn2gushScJl6bRlA4vGCmYA+cO2d8O0rpkkJxWGq0K5LGb7umBkSNO0hyG DgngHviH8pYkqn9D1X7FuG2t912X4qg/db5Fp3NuS8ZRWJ9tk7fgWzLveNizsPS3 m8bqxikJ/RJL9g0EHURtzJWc2liBYGTtqhO5oeM2kovmaOn7a//AhnTcOZn2/eOe WiOmPRxSjjFyugREK+bAGTSfVq83003CJQ+kHg+cfOqBbCT+0J0LwLQAeLiKrLPS 07HVns3TAgMBAAECggEAFfns32gx90zH1y9YvbJpQ7/6pY5+/Ukl7xOQM5USMrNl ZKiCzaVCbErWBjGrGwqft2S/WKehfSt4F5FAQk1izDfWp0fMpFwCmYmFHEEuegHg C1Lp/UksEJ2/WxskQKLA+vdhpyGOsY5UJzGlsU2PqXN1+j34x9fzaBR5ps8JK5kF rbwr8En+hsfShSn3nklMiEyBI7bPDbpaq2Qjpfay/XRzqRdkPhsd+n03ADKGd4ax lyAe/VFak6JdpTy+oxWjc2dr2mOWIX9sOCSVOL7sTVX3Wcxhg0FlNbwmbx6nF+UW OJxVO9UNod/OtzSzYsqObJ/z76itUMcBnDl7almtjQKBgQC3Doo8UlvECcQvkrny Nk49oOLaheZA8R2Cw+3oK3ufMvahLEemxCFlZjbkmoeeRySzyPCs7jEr8HK1GQGu tv8yS4mkx7lCR2B3jl0NJ7r7kcitZh4VFaMXJORwpMoawMeWvc/u7Xh+OZRMp7c2 bfc9114dynCDtwp+dLjG8+y+5wKBgQDCRTlxXu7Kg5AL7H07n5q1r9IfOqfL4inB LXNEciddvaOtFzomjr/6sbGdK+ICeFyk9E12esWnbziaI/E8oSogL4dX+t5hbc5T tvrPs/mILztR1xvUdTNLyT9SOr7dEehytvOLsuHlFcCli7H6nZdrRCVFgeYXWZhM KR5Uagl4NQKBgQCOTHY2+AqvtKvWE2gKmh5uF9/g4Q+hUg2PtkD9JrgdhB9mIKa+ Q152lWN8h4d/CWzFeSFmPG7q6ioxDvRY3ZY5gbDI8BzaIeQia/93l3fp0WS/Lk+a MkyqVBpkWiVlcJB2ZKz73Yu6C4Z1pDZu0ELOxtk5rUGTkjlNHez5c2qI5wKBgQC1 NbMWQBIHjt6vcKGEGyVJcj5SaPkZodWG3ulVIBH+S6VAEJlqW99RbayaSdOgsDri lwsmh/CUdJdcmEguYLqVmR/q/hOu16kMx3J+iYcp87ymYzsPW19EwuywvCFKvqiP UH4ugeZaNIclJAAZICScps0JX9iLUURRTk1/OgWpPQKBgAD6pmbZCYk0B8TClPvs FSV12HUdMo9f7jteQP4TkmJhi+IOrMmBWVrwH6JgPf/awJPhmGM+g375JswSeugd u7ovcvivsL5JKNMeM35SfrF3xZ3VxX7jcOt/gM1nK9vXgGMJivf5TQIaF0piuwzG b5tlHhnq33FF0Y8MYB2Y4d4B\n-----END PRIVATE KEY-----')");
        postgresService.execute("DROP TABLE IF EXISTS payersystem_data");
        postgresService.execute("CREATE TABLE payersystem_data (\n" +
                "    request_id character varying not null PRIMARY KEY,\n" +
                "    sender_code character varying,\n" +
                "    recipient_code character varying,\n" +
                "    action character varying,\n" +
                "    raw_payload character varying,\n" +
                "    request_fhir character varying,\n" +
                "    response_fhir character varying,\n" +
                "    status character varying,\n" +
                "    additional_info jsonb,\n" +
                "    created_on bigint,\n" +
                "    updated_on bigint,\n" +
                "    on_action_status character varying,\n" +
                "    correlation_id character varying,\n" +
                "    mobile character varying,\n" +
                "    otp_verification character varying,\n" +
                "    workflow_id character varying,\n" +
                "    account_number character varying,\n" +
                "    ifsc_code character varying,\n" +
                "    bank_details character varying,\n" +
                "    app character varying,\n" +
                "    supporting_documents jsonb,\n" +
                "    bill_amount character varying,\n" +
                "    insurance_id character varying,\n" +
                "    patient_name character varying,\n" +
                "    service_type character varying\n" +
                ");\n");
        postgresService.execute("INSERT INTO payersystem_data" +
                "(request_id, sender_code, recipient_code, action, raw_payload, request_fhir, response_fhir, status, additional_info, created_on, updated_on, on_action_status, correlation_id, mobile, otp_verification, workflow_id, account_number, ifsc_code, bank_details, app, supporting_documents, bill_amount, insurance_id, patient_name, service_type)" +
                "VALUES" + "('7b128be8-6a31-4305-a1cc-8d1e6a6fcc04', 'bsp_bsprol_846730@swasth-hcx-dev', 'payr_hcxmoc_903588@swasth-hcx-dev', 'claim', 'eyJ4LWhjeC1yZWNpcGllbnRfY29kZSI6ImJzcF9ic3Byb2xfODQ2NzMwQHN3YXN0aC1oY3gtZGV2IiwieC1oY3gtdGltZXN0YW1wIjoiMjAyNC0wMS0yNFQwNzoxOTo1NCswMDAwIiwieC1oY3gtc2VuZGVyX2NvZGUiOiJwYXlyX2hjeG1vY185MDM1ODhAc3dhc3RoLWhjeC1kZXYiLCJ4LWhjeC1jb3JyZWxhdGlvbl9pZCI6ImRkYzQ5YjE0LWViYzAtNDY4Ni1hMjk3LTIzOWJlZDgyMzg5ZiIsImVuYyI6IkEyNTZHQ00iLCJ4LWhjeC13b3JrZmxvd19pZCI6IjdhNTQ5NzAyLWRkYjItNGU3Mi1hYzIxLTQzOGQxZmUzYzQzOSIsImFsZyI6IlJTQS1PQUVQLTI1NiIsIngtaGN4LWFwaV9jYWxsX2lkIjoiMDQ1YTYwZDEtZDczYS00ZGE5LTkzZmQtNzk3NzRjNzRmNDZiIn0.gVvap-Bq5lKqsq28LEikeoSX6l4QZuKXGLke_xH5gW7RCViNFqkuoqlF951Yv-9xslx901QsAvZHOZ9h7fJoUmYe03-7_CGP_IN79dygujmnkbyNGb7Pt2ytpPbXyJbeUmU5VKugbs-Ux1UZ5xCb0f8A4blB2gFG8cGSjx_cGfYEndGVNRMiPH4loLnPn7QQ5GULJk2zRY9ITdOJv_s_RKOfdqINtoJq0SPB9A2jEPqBYvAcc4UeNkaFKV-vTDs4Dsi3ynrQIwIoqGZUPsEL_RU7jKTf5NTA5tk01bSSrBBIkMBFq3QcpiypEZPl8azJAodtyeb1gJrydxTHnim3oQ.x7ZRbCg-ByChU5lq.dgfEIAmcD_W3nbCshly5txshHyL9ckpH--YQI-ovJ-8yTWDDAWvLRmfkSi5jMHktWPk7RIMUFslVwYMy2PsBreNEJeo49ACbrsxXP8I8yarMlDGx1c9tYGruEiqh9-QwKMLgLXr8z0fuTopQlkXKoCvmdE4N7ALxL_ixzw8lCSUBzbUER9biYAfuKcr4ZNNfc0KJMiTOXBu0VDwz2ndK0XO7SSAGu4VLFm_l1dsvKiCauPkER4h72wPrgJ8qf8z8v6WSH9ryajIQ_TQq1cmLsi7RLx7wpqpmdO8OFm_0PkIIcEk1tBPVuXBntl6fKNttAyeRwp4NeJo85s14YjmysyuuI0O24-OR-cpYacUrDVY5dE14JMTU1-lq_9hUPHtxRvXfhR5WdBnsCeyQg2DL78gw4sD8TsQhe-UNhTrxIgXg6GCcUxJiYRW_MTuNwJ4LXt7FQwhUF7ZAmyNlZ_hmzTiyjVqJ8vfR-MZGVQMRLIeZQAcnpiXfd-zkx0omCW3EfHV8a2H6D6Ig56YVK-CLW81T9fJWS9_M45R7TFythsUeRoai4hRVbWp4WUinOLdBKPJddoDCL5x_YbRTXj7pl39ltQeSt64myLNyq-ZQ3XJrH3YV_nSAbNW_wB8.mss8qUyRt_PBpQQHFji4Rg', '{}', '{\"identifier\":{\"system\":\"https://www.tmh.in/bundle\",\"value\":\"f3f964cc-ca80-4b6a-a465-4bd644d42b0f\"},\"entry\":[{\"resource\":{\"insurance\":[{\"coverage\":{\"reference\" :\"Coverage/COVERAGE1\"}}],\"identifier\":[{\"value\":\"req_70e02576-f5f5-424f-b115-b5f1029704d4\"}],\"item\":[{\"diagnosis\":[{\"diagnosisCodeableConcept\":{\"coding\":[{\"system\":\"https://irdai.gov.in/package-code\",\"cod e\":\"E906184\",\"display\":\"SINGLE INCISION LAPAROSCOPIC APPENDECTOMY\"}],\"text\":\"SINGLE INCISION LAPAROSCOPIC APPENDECTOMY\"}}],\"productOrService\":{\"coding\":[{\"system\":\"https://irdai.gov.in/package-code\",\"code \":\"E101021\",\"display\":\"Twin Sharing Ac\"}],\"text\":\" twin sharing basis room package\"}}],\"purpose\":[\"benefits\"],\"created\":\"2024-01-19T10:55:12+00:00\",\"priority\":{\"coding\":[{\"system\":\"http://terminology.hl7. org/CodeSystem/processpriority\",\"code\":\"normal\"}]},\"provider\":{\"reference\":\"Organization/GICOFINDIA\"},\"meta\":{\"profile\":[\"https://ig.hcxprotocol.io/v0.7.1/StructureDefinition-CoverageEligibilityRequest.ht ml\"]},\"patient\":{\"reference\":\"Patient/RVH1003\"},\"insurer\":{\"reference\":\"Organization/WeMeanWell01\"},\"enterer\":{\"reference\":\"Practitioner/PractitionerViswasKar\"},\"id\":\"dc82673b-8c71-48c2-8a17-16dcb3b035f6\" ,\"text\":{\"div\":\"<div xmlns=\\\"http://www.w3.org/1999/xhtml\\\">ABSP</div>\",\"status\":\"generated\"},\"servicedDate\":\"0026-12-13\",\"facility\":{\"reference\":\"http://sgh.com.sa/Location/4461281\"},\"resourceType\":\"Cove rageEligibilityRequest\",\"status\":\"active\"},\"fullUrl\":\"CoverageEligibilityRequest/dc82673b-8c71-48c2-8a17-16dcb3b035f6\"},{\"resource\":{\"identifier\":[{\"system\":\"http://abdm.gov.in/facilities\",\"type\":{\"coding \":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"AC\",\"display\":\"Narayana\"}]},\"value\":\"HFR-ID-FOR-TMH\"}],\"address\":[{\"country\":\"India\",\"city\":\"Bengaluru\",\"text\":\" Bannerghatta Road, Ben galuru \"}],\"meta\":{\"profile\":[\"https://nrces.in/ndhm/fhir/r4/StructureDefinition/Organization\"]},\"name\":\"BSP Role Mock User\",\"id\":\"WeMeanWell01\",\"resourceType\":\"Organization\"},\"fullUrl\":\"Organization/WeMe anWell01\"},{\"resource\":{\"identifier\":[{\"system\":\"http://irdai.gov.in/insurers\",\"type\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"AC\",\"display\":\"GOVOFINDIA\"}]},\"value\":\"GI COFINDIA\"}],\"meta\":{\"profile\":[\"https://nrces.in/ndhm/fhir/r4/StructureDefinition/Organization\"]},\"name\":\"Demo Payor\",\"id\":\"GICOFINDIA\",\"resourceType\":\"Organization\"},\"fullUrl\":\"Organization/GICOFINDIA\"}, {\"resource\":{\"identifier\":[{\"system\":\"http://gicofIndia.com/beneficiaries\",\"type\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"SN\",\"display\":\"Subscriber Number\"}]},\"value\": \"BEN-101\"}],\"address\":[{\"country\":\"India\",\"city\":\"Bengaluru\",\"postalCode\":\"560056\",\"text\":\"#39 Kalena Agrahara, Kamanahalli, Bengaluru - 560056\",\"state\":\"Karnataka\"}],\"gender\":\"male\",\"meta\":{\"profile\":[\"h ttps://nrces.in/ndhm/fhir/r4/StructureDefinition/Patient\"]},\"name\":[{\"text\":\"Abhishek\"}],\"telecom\":[{\"system\":\"phone\",\"value\":\"9620499129\"}],\"id\":\"RVH1003\",\"birthDate\":\"1960-09-26\",\"resourceType\":\"Patient \"},\"fullUrl\":\"Patient/RVH1003\"},{\"resource\":{\"identifier\":[{\"system\":\"https://www.gicofIndia.in/policies\",\"value\":\"policy-RVH1003\"}],\"subscriber\":{\"reference\":\"Patient/RVH1003\"},\"payor\":[{\"reference\":\"Org anization/GICOFINDIA\"}],\"beneficiary\":{\"reference\":\"Patient/RVH1003\"},\"meta\":{\"profile\":[\"https://ig.hcxprotocol.io/v0.7.1/StructureDefinition-Coverage.html\"]},\"subscriberId\":\"ABCD1234\",\"id\":\"COVERAGE1\",\" relationship\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/subscriber-relationship\",\"code\":\"self\"}]},\"resourceType\":\"Coverage\",\"status\":\"active\"},\"fullUrl\":\"Coverage/COVERAGE1\"},{\"resource\" :{\"identifier\":[{\"system\":\"http://abdm.gov.in/facilities\",\"type\":{\"coding\":[{\"system\":\"http://terminology.hl7.org/CodeSystem/v2-0203\",\"code\":\"MD\",\"display\":\"Medical License number\"}]},\"value\":\"DOC-123/456 \"}],\"meta\":{\"profile\":[\"https://nrces.in/ndhm/fhir/r4/StructureDefinition/Practitioner\"]},\"name\":[{\"text\":\"Dr Viswas kar\"}],\"id\":\"PractitionerViswasKar\",\"resourceType\":\"Practitioner\"},\"fullUrl\":\"Practitio ner/PractitionerViswasKar\"}],\"meta\":{\"lastUpdated\":\"2024-01-19T10:55:13.300+00:00\",\"profile\":[\"https://ig.hcxprotocol.io/v0.7.1/StructureDefinition-CoverageEligibilityRequestBundle.html\"]},\"id\":\"4b35c99b- 4081-46c6-b927-98720d8ac8a6\",\"type\":\"collection\",\"resourceType\":\"Bundle\",\"timestamp\":\"2024-01-19T10:55:13.300+00:00\"}', 'Approved', '{}', '1705661714568', '1705661715600', '', 'ddc49b14-ebc0-4686-a297-239bed82389f', '9620499129', 'Pending', '7a549702-ddb2-4e72-ac21-438d1fe3c439', '1234', '1234', 'Pending', 'ABSP', '{}', '32329', 'ABCD1234.', 'Abhishek.', 'medical')");
        String requestBody = getCommunicationOnRequestBody();
        MvcResult mvcResult = mockMvc.perform(post("/"+api_version+"/communication/on_request").content(requestBody).contentType(MediaType.APPLICATION_JSON)).andReturn();
        MockHttpServletResponse response = mvcResult.getResponse();
        int status = response.getStatus();
        assertEquals(202, status);
    }

}
